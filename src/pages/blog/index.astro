---
import { getCollection } from "astro:content";
import BaseLayout from "../../layouts/BaseLayout.astro";

const posts = await getCollection("blog");
const sortedPosts = posts.sort(
  (a, b) => b.data.pubDate - a.data.pubDate
);
---

<BaseLayout title="Blog" description="Nickâ€™s notes and posts.">
  <section>
    <h1>Blog</h1>

    {sortedPosts.length === 0 && <p>No posts yet.</p>}

    {sortedPosts.length > 0 && (
      <ul class="blog-list">
        {sortedPosts.map((post) => {
          const tags = post.data.tags ?? [];
          return (
            <li class="blog-list__item">
              <h2 class="blog-list__title">
                <a href={`/blog/${post.slug}/`}>{post.data.title}</a>
              </h2>

              <p class="blog-list__meta">
                <span class="blog-list__date">
                  {post.data.pubDate}
                </span>

                {tags.length > 0 && (
                  <span class="blog-list__tag-row">
                    {tags.map((tag) => (
                      <a
                        href={`/tags/${encodeURIComponent(tag)}/`}
                        class="tag-pill"
                      >
                        {tag}
                      </a>
                    ))}
                  </span>
                )}
              </p>
            </li>
          );
        })}
      </ul>
    )}
  </section>
</BaseLayout>

